<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node常用模块以及注意事项 | ironBlog</title>
    <meta name="description" content="代码千万行, 注释第一行！">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <meta name="author" content="ironc">
  <meta name="keywords" content="vuepress,iron,ironc,ironBlog">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#42b983">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icon_iron.png">
  <link rel="mask-icon" href="/icon_vuepress_reco.svg" color="#42b983">
  <meta name="msapplication-TileImage" content="/icon_iron.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.d015bd9a.css" as="style"><link rel="preload" href="/assets/js/app.83e161de.js" as="script"><link rel="preload" href="/assets/js/5.0d63161d.js" as="script"><link rel="preload" href="/assets/js/1.c082d7cd.js" as="script"><link rel="preload" href="/assets/js/75.04bedc64.js" as="script"><link rel="prefetch" href="/assets/js/10.5a2bf853.js"><link rel="prefetch" href="/assets/js/100.341d6803.js"><link rel="prefetch" href="/assets/js/101.32e1b467.js"><link rel="prefetch" href="/assets/js/102.2a758bc3.js"><link rel="prefetch" href="/assets/js/103.b23714a9.js"><link rel="prefetch" href="/assets/js/104.8f986640.js"><link rel="prefetch" href="/assets/js/105.0e71d110.js"><link rel="prefetch" href="/assets/js/106.bca2668d.js"><link rel="prefetch" href="/assets/js/107.ee2c7eb9.js"><link rel="prefetch" href="/assets/js/108.727b1d9d.js"><link rel="prefetch" href="/assets/js/109.2ba56e85.js"><link rel="prefetch" href="/assets/js/11.22436645.js"><link rel="prefetch" href="/assets/js/110.4f26b120.js"><link rel="prefetch" href="/assets/js/111.13482f6c.js"><link rel="prefetch" href="/assets/js/112.4e216b6c.js"><link rel="prefetch" href="/assets/js/113.5b300282.js"><link rel="prefetch" href="/assets/js/114.32ff42c8.js"><link rel="prefetch" href="/assets/js/115.776bb002.js"><link rel="prefetch" href="/assets/js/116.44fb07b2.js"><link rel="prefetch" href="/assets/js/117.20a95dce.js"><link rel="prefetch" href="/assets/js/118.0271818c.js"><link rel="prefetch" href="/assets/js/119.72a09782.js"><link rel="prefetch" href="/assets/js/12.efa80d60.js"><link rel="prefetch" href="/assets/js/120.152be925.js"><link rel="prefetch" href="/assets/js/121.28191eb6.js"><link rel="prefetch" href="/assets/js/122.a8a4c9cf.js"><link rel="prefetch" href="/assets/js/123.27d66749.js"><link rel="prefetch" href="/assets/js/124.b7b656b1.js"><link rel="prefetch" href="/assets/js/125.199fc395.js"><link rel="prefetch" href="/assets/js/126.9de89495.js"><link rel="prefetch" href="/assets/js/127.687293a9.js"><link rel="prefetch" href="/assets/js/128.fe9b6bda.js"><link rel="prefetch" href="/assets/js/129.d3f51d3c.js"><link rel="prefetch" href="/assets/js/13.be799c66.js"><link rel="prefetch" href="/assets/js/130.ec2c9ec1.js"><link rel="prefetch" href="/assets/js/131.0b756b70.js"><link rel="prefetch" href="/assets/js/132.7f6b6e60.js"><link rel="prefetch" href="/assets/js/14.06cfb990.js"><link rel="prefetch" href="/assets/js/15.6bdab235.js"><link rel="prefetch" href="/assets/js/16.cc42b80e.js"><link rel="prefetch" href="/assets/js/17.5d94f0e4.js"><link rel="prefetch" href="/assets/js/18.ac053580.js"><link rel="prefetch" href="/assets/js/19.b45f7e40.js"><link rel="prefetch" href="/assets/js/2.cf77cff5.js"><link rel="prefetch" href="/assets/js/20.fa1fd436.js"><link rel="prefetch" href="/assets/js/21.beb35f18.js"><link rel="prefetch" href="/assets/js/22.ac95038e.js"><link rel="prefetch" href="/assets/js/23.51171ad7.js"><link rel="prefetch" href="/assets/js/24.633914c4.js"><link rel="prefetch" href="/assets/js/25.cd8a9e0c.js"><link rel="prefetch" href="/assets/js/26.e085b6e0.js"><link rel="prefetch" href="/assets/js/27.0fd9eec4.js"><link rel="prefetch" href="/assets/js/28.4bd0c161.js"><link rel="prefetch" href="/assets/js/29.c6a3eb07.js"><link rel="prefetch" href="/assets/js/30.b71e5e57.js"><link rel="prefetch" href="/assets/js/31.5b9a5243.js"><link rel="prefetch" href="/assets/js/32.407f3592.js"><link rel="prefetch" href="/assets/js/33.c80d2126.js"><link rel="prefetch" href="/assets/js/34.ee1350f8.js"><link rel="prefetch" href="/assets/js/35.880af7b6.js"><link rel="prefetch" href="/assets/js/36.118c4f3b.js"><link rel="prefetch" href="/assets/js/37.0b949336.js"><link rel="prefetch" href="/assets/js/38.bc0fda1d.js"><link rel="prefetch" href="/assets/js/39.6e73bd30.js"><link rel="prefetch" href="/assets/js/40.d3d450de.js"><link rel="prefetch" href="/assets/js/41.b2075eeb.js"><link rel="prefetch" href="/assets/js/42.8b33d671.js"><link rel="prefetch" href="/assets/js/43.e23aa859.js"><link rel="prefetch" href="/assets/js/44.a9a651f0.js"><link rel="prefetch" href="/assets/js/45.e83d0dd5.js"><link rel="prefetch" href="/assets/js/46.3d3e6d04.js"><link rel="prefetch" href="/assets/js/47.7ae5e9f8.js"><link rel="prefetch" href="/assets/js/48.5f3513ed.js"><link rel="prefetch" href="/assets/js/49.97c34716.js"><link rel="prefetch" href="/assets/js/50.2c3d809d.js"><link rel="prefetch" href="/assets/js/51.4836b073.js"><link rel="prefetch" href="/assets/js/52.913f29a6.js"><link rel="prefetch" href="/assets/js/53.0d2108bd.js"><link rel="prefetch" href="/assets/js/54.c2d90f63.js"><link rel="prefetch" href="/assets/js/55.1dc38ee4.js"><link rel="prefetch" href="/assets/js/56.7a75ea38.js"><link rel="prefetch" href="/assets/js/57.068b0add.js"><link rel="prefetch" href="/assets/js/58.27e01acd.js"><link rel="prefetch" href="/assets/js/59.95b679ec.js"><link rel="prefetch" href="/assets/js/6.4834e6b0.js"><link rel="prefetch" href="/assets/js/60.f439358c.js"><link rel="prefetch" href="/assets/js/61.949320af.js"><link rel="prefetch" href="/assets/js/62.f12236b6.js"><link rel="prefetch" href="/assets/js/63.7005e8d2.js"><link rel="prefetch" href="/assets/js/64.47d4ecc8.js"><link rel="prefetch" href="/assets/js/65.a800c419.js"><link rel="prefetch" href="/assets/js/66.853172d1.js"><link rel="prefetch" href="/assets/js/67.60903ed2.js"><link rel="prefetch" href="/assets/js/68.e075bc7e.js"><link rel="prefetch" href="/assets/js/69.d4ac3843.js"><link rel="prefetch" href="/assets/js/7.4305f9b1.js"><link rel="prefetch" href="/assets/js/70.f98cddc6.js"><link rel="prefetch" href="/assets/js/71.0f05c250.js"><link rel="prefetch" href="/assets/js/72.b5df2f2c.js"><link rel="prefetch" href="/assets/js/73.2e5cf38f.js"><link rel="prefetch" href="/assets/js/74.63206a4d.js"><link rel="prefetch" href="/assets/js/76.f81cc7ed.js"><link rel="prefetch" href="/assets/js/77.f2dcb4b6.js"><link rel="prefetch" href="/assets/js/78.33e8cb42.js"><link rel="prefetch" href="/assets/js/79.64ddfd00.js"><link rel="prefetch" href="/assets/js/8.129eff9a.js"><link rel="prefetch" href="/assets/js/80.3b02c2c1.js"><link rel="prefetch" href="/assets/js/81.b4e81617.js"><link rel="prefetch" href="/assets/js/82.5f4a0db5.js"><link rel="prefetch" href="/assets/js/83.02064120.js"><link rel="prefetch" href="/assets/js/84.58c915c5.js"><link rel="prefetch" href="/assets/js/85.f0352e26.js"><link rel="prefetch" href="/assets/js/86.559dd1e5.js"><link rel="prefetch" href="/assets/js/87.f9b7caf6.js"><link rel="prefetch" href="/assets/js/88.42c8012e.js"><link rel="prefetch" href="/assets/js/89.5f21f32b.js"><link rel="prefetch" href="/assets/js/9.2cb37f5a.js"><link rel="prefetch" href="/assets/js/90.d798869e.js"><link rel="prefetch" href="/assets/js/91.ccbb24ec.js"><link rel="prefetch" href="/assets/js/92.867ba004.js"><link rel="prefetch" href="/assets/js/93.6e3b5ecd.js"><link rel="prefetch" href="/assets/js/94.2243f750.js"><link rel="prefetch" href="/assets/js/95.ae6d8db5.js"><link rel="prefetch" href="/assets/js/96.245ac3c0.js"><link rel="prefetch" href="/assets/js/97.145df6c7.js"><link rel="prefetch" href="/assets/js/98.8408d1a9.js"><link rel="prefetch" href="/assets/js/99.940917b9.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5bf7fb9f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d015bd9a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><Common><main class="page"><div class="page-title" style="display:none;"><h1>node常用模块以及注意事项</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>iron</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2020-08-29</span></i> <!----> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      node
    </span></i></div></div> <div class="content__default"><h3 id="module-模块-常用以及注意事项"><a href="#module-模块-常用以及注意事项" class="header-anchor">#</a> module (模块) 常用以及注意事项</h3> <ul><li><p>模块封装器</p> <ul><li><p>在执行模块代码之前，Node.js 会使用一个如下的函数封装器将其封装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    connsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'模块的代码实际上在这里'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>如何创建一个模块</p> <ul><li><p>创建一个文件 =&gt; 实现了私有作用域</p> <div class="language- extra-class"><pre class="language-text"><code>// 文件名为02_myModule.js
</code></pre></div></li> <li><p>编写一些操作，逻辑，数值等</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义一个变量</span>
<span class="token keyword">let</span> testVar <span class="token operator">=</span> <span class="token string">'test'</span>
<span class="token comment">// 定义一个函数</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>testVar<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>对外抛出</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用module.exports向外暴露</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>testVar <span class="token operator">=</span> testVar
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>testFn <span class="token operator">=</span> test
</code></pre></div></li> <li><p>完整代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义一个变量</span>
<span class="token keyword">let</span> testVar <span class="token operator">=</span> <span class="token string">'test'</span>
<span class="token comment">// 定义一个函数</span>
<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>testVar<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 向外暴露</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>testVar <span class="token operator">=</span> testVar
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>testFn <span class="token operator">=</span> test
</code></pre></div></li></ul></li> <li><p>如何引用一个模块</p> <ul><li><p>/ 绝对路径， ./ ../ 相对路径</p> <ul><li>支持js,json,node扩展名，不写扩展名以此尝试， 均不存就报错</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> myMo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./02_myModule'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>不写路径则认为是build-in模块或者各级的node_modules内的第三方模块</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">VUE</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vue'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>引用内置模块的方式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 内置模块fs 模块是用来读取二进制流 </span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> result <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./07_fs.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token comment">// 讲16进制转义为string</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 读取文件为异步操作，直接打印 undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>引用外部模块</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> myMo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./02_myModule'</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>引用文件名为02_myModule.js 并使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 支持js,json,node扩展名，不写扩展名以此尝试， 均不存就报错</span>
<span class="token keyword">const</span> myMo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./02_myModule'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myMo<span class="token punctuation">.</span>testVar<span class="token punctuation">)</span>
myMo<span class="token punctuation">.</span><span class="token function">testFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h4 id="require-特别注意"><a href="#require-特别注意" class="header-anchor">#</a> require 特别注意</h4> <ul><li><p>module 被加载的时候执行，加载后缓存</p></li> <li><p>一但出现模块被循环加载的，就只输出已经执行的部分，还未执行的部分不会输出、</p></li> <li><p>04_moduleA.js</p> <div class="language-js extra-class"><pre class="language-js"><code>    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token string">'A'</span>
    
    <span class="token keyword">const</span> modB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./05_moduleB'</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'modA：'</span><span class="token operator">+</span> modB<span class="token punctuation">.</span>test<span class="token punctuation">)</span>
    
    <span class="token comment">// 再次定义</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token string">'AA'</span>
</code></pre></div></li> <li><p>05_moduleB.js</p> <div class="language-js extra-class"><pre class="language-js"><code>    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token string">'B'</span>
    
    <span class="token keyword">const</span> modA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./04_moduleA'</span><span class="token punctuation">)</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'modB：'</span><span class="token operator">+</span> modA<span class="token punctuation">.</span>test<span class="token punctuation">)</span>
    
    <span class="token comment">// 再次定义</span>
    module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token string">'BB'</span>
</code></pre></div></li> <li><p>06_main.js</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> modA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./04_moduleA'</span><span class="token punctuation">)</span>
    <span class="token comment">//1 引用 04_moduleA </span>
    <span class="token comment">//2 其内部引用并执行05_moduleB</span>
    <span class="token comment">//3 05_moduleB 内部引用了04_moduleA， 这时04_moduleA 中的module.exports.test = A。所以第一次打印modB：A</span>
    <span class="token comment">//  将module.exports.test = 'BB' =&gt; 至此 引入05_moduleB 执行完毕，写入缓存</span>
    <span class="token comment">//4 接续2步04_moduleA 继续执行 所以第二次打印modA：BB ，并且重置 module.exports.test = 'AA'</span>
    <span class="token keyword">const</span> modB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./05_moduleB'</span><span class="token punctuation">)</span>
    <span class="token comment">//5 直接读取缓存 </span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modA<span class="token punctuation">.</span>test<span class="token punctuation">)</span>
    <span class="token comment">//6 第三次打印 AA</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>modB<span class="token punctuation">.</span>test<span class="token punctuation">)</span>
    <span class="token comment">//7 第四次打印 BB</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 后台打印</span>
    modB：<span class="token constant">A</span>
    modA：<span class="token constant">BB</span>
    <span class="token constant">AA</span>
    <span class="token constant">BB</span>
</code></pre></div></li></ul> <h4 id="module-特别注意"><a href="#module-特别注意" class="header-anchor">#</a> module 特别注意</h4> <ul><li><p>exports 和module.exports的区别</p> <ul><li><p>exports 是module.exports 的简写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//相当于</span>
<span class="token keyword">const</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports
<span class="token comment">// 其指向不能被改变</span>
exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span><span class="token number">1</span> <span class="token comment">// undefined 报错，因为改变了指向</span>
<span class="token punctuation">}</span>
<span class="token comment">// 就要自定义输出内容, 使用全写</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h4 id="global"><a href="#global" class="header-anchor">#</a> global</h4> <ul><li><p>global 顶级对象</p> <ul><li><p>类比于js 中的window</p></li> <li><p>CommonJS</p></li> <li><p>Buffer process console等常用方法  =&gt; 其下挂载方法</p></li> <li><p>timer =&gt; 一系列定时操作</p></li> <li><p>具体</p> <ul><li>声明对象分为局部以及全局，使用global.XXX 声明的对象为全局对象，其直接挂载在全局global下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//09_global 文件</span>
<span class="token comment">// 声明局部变量</span>
<span class="token keyword">const</span> testVar <span class="token operator">=</span> <span class="token number">100</span>

<span class="token comment">// 声明全局变量</span>
global<span class="token punctuation">.</span>testVar2 <span class="token operator">=</span> <span class="token number">1000</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>testVar <span class="token operator">=</span> testVar
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用区别</span>
<span class="token keyword">const</span> mod <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./09_global'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mod<span class="token punctuation">.</span>testVar<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>testVar2<span class="token punctuation">)</span> <span class="token comment">// 既不用导出也不用引用即可使用</span>
</code></pre></div></li></ul></li></ul> <h4 id="process"><a href="#process" class="header-anchor">#</a> process</h4> <ul><li><p>process  global 挂载的进程</p> <ul><li><p>process 常用参数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token parameter">argv</span> <span class="token operator">=&gt;</span> 进程启动时的参数集 是一个数组
    <span class="token number">1.</span> 首参 启动node程序的路径
    <span class="token number">2.</span> 第二个参数 启动脚本文件的路径
    <span class="token number">3.</span> 如果进行文件名后传参 即对启动的文件做配置 node xxx<span class="token punctuation">.</span>js a<span class="token operator">=</span><span class="token number">1</span> b<span class="token operator">=</span><span class="token number">2</span>
        则会有相应的参数存储进入argv数组 否则为空数组
<span class="token parameter">argv0</span> <span class="token operator">=&gt;</span> argv 的第一个参数 
<span class="token parameter">execArgv</span> <span class="token operator">=&gt;</span>  node <span class="token operator">--</span>inspect xxx<span class="token punctuation">.</span>js
   写在文件名前面的参数，即对node做启动配置参数
<span class="token parameter">execPath</span> <span class="token operator">=&gt;</span> node 调用脚本的路径，即node的启动路径
</code></pre></div></li> <li><p>process 环境</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">const</span> <span class="token punctuation">{</span>env<span class="token punctuation">}</span> <span class="token operator">=</span> process
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span> <span class="token comment">// 保存了启动环境的配置</span>
    <span class="token punctuation">{</span> <span class="token constant">ALLUSERSPROFILE</span><span class="token operator">:</span> <span class="token string">'C:\\ProgramData'</span><span class="token punctuation">,</span>
      <span class="token operator">...</span>
      <span class="token punctuation">.</span><span class="token punctuation">.</span>
      <span class="token punctuation">.</span>
      <span class="token constant">USERNAME</span><span class="token operator">:</span> <span class="token string">'Administrator'</span><span class="token punctuation">,</span>
      <span class="token constant">USERPROFILE</span><span class="token operator">:</span> <span class="token string">'C:\\Users\\Administrator'</span><span class="token punctuation">,</span>
      windir<span class="token operator">:</span> <span class="token string">'C:\\Windows'</span><span class="token punctuation">,</span>
      windows_tracing_flags<span class="token operator">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
      windows_tracing_logfile<span class="token operator">:</span> <span class="token string">'C:\\BVTBin\\Tests\\installpackage\\csilogfile.log'</span><span class="token punctuation">,</span>
      <span class="token constant">TERM_PROGRAM</span><span class="token operator">:</span> <span class="token string">'vscode'</span><span class="token punctuation">,</span>
      <span class="token constant">TERM_PROGRAM_VERSION</span><span class="token operator">:</span> <span class="token string">'1.36.1'</span><span class="token punctuation">,</span>
      <span class="token constant">LANG</span><span class="token operator">:</span> <span class="token string">'zh_CN.UTF-8'</span> <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>process cwd =&gt; 注意这个是process的直属方法</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 当前进程的路径</span>
<span class="token constant">F</span><span class="token operator">:</span>\xxx\node_xxx\demo
</code></pre></div></li> <li><p>process timer</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 最后执行 全局global 直属的   =&gt; 下个队列队首</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setImmediate'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 在这两个之间执行 也是global直属的</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment">// 最先执行 在当前队列最后，所以先执行</span>
    process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'nextTick'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul> <h3 id="内置模块path"><a href="#内置模块path" class="header-anchor">#</a> 内置模块path</h3> <ul><li><p>模块提供用于处理文件路径和目录路径的实用工具</p></li> <li><p>path 模块的默认操作因 Node.js 应用程序运行所在的操作系统而异。 具体来说，当在 Windows 操作系统上运行时， path 模块将假定正在使用 Windows 风格的路径。因此，使用 path.basename() 可能会在 POSIX 和 Windows 上产生不同的结果</p> <ul><li><p>path.normalize() 方法规范化给定的 path，解析 '..' 和 '.' 片段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>normalize<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">normalize</span><span class="token punctuation">(</span><span class="token string">'./..//'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 给定不规范的路径</span>
<span class="token comment">// 输出规范路径 ..\</span>
</code></pre></div></li> <li><p>path.join() 方法使用平台特定的分隔符作为定界符将所有给定的 path 片段连接在一起，然后规范化生成的路径。（处理了上下级关系等）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>join<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">,</span><span class="token string">'../'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// 输出 \user\</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token string">'aaa'</span><span class="token punctuation">,</span><span class="token string">'../'</span><span class="token punctuation">,</span> <span class="token string">'bbb'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 输出 \user\bbb</span>
</code></pre></div></li> <li><p>path.resolve() 方法将路径或路径片段的序列解析为绝对路径。</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 输出绝对路径 E:\xxx\xxxx\xxxx\api</span>
</code></pre></div></li> <li><p>path.basename() 方法返回 path 的最后一部分，类似于 Unix 的 basename 命令。 尾部的目录分隔符将被忽略</p></li> <li><p>path.dirname() 方法返回 path 的目录名，类似于 Unix 的 dirname 命令。 尾部的目录分隔符将被忽略</p></li> <li><p>path.extname() 方法返回 path 的扩展名，从最后一次出现 .（句点）字符到 path 最后一部分的字符串结束</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>basename<span class="token punctuation">,</span> dirname<span class="token punctuation">,</span>extname<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token string">'user/saa/xzz.txt'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// xzz.txt</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// user/saa</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">extname</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// .txt</span>
</code></pre></div></li> <li><p>path.parse() 方法返回一个对象，其属性表示 path 的重要元素。 尾部的目录分隔符将被忽略</p></li> <li><p>path.format() 与 path.parse() 行为相反</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>parse<span class="token punctuation">,</span> format<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'/user/data/aaa/b.js'</span>
<span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token comment">//{ root: '/',</span>
<span class="token comment">//  dir: '/user/data/aaa',</span>
<span class="token comment">//  base: 'b.js',</span>
<span class="token comment">//  ext: '.js',</span>
<span class="token comment">//  name: 'b' }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">format</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// /user/data/aaa\b.js</span>
</code></pre></div></li> <li><p>提供平台特定的路径片段分隔符：</p> <div class="language-js extra-class"><pre class="language-js"><code>Windows 上是 \。
<span class="token constant">POSIX</span> 上是 <span class="token operator">/</span>。
</code></pre></div></li> <li><p>提供平台特定的路径定界符：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span> 用于 Windows
<span class="token operator">:</span> 用于 <span class="token constant">POSIX</span>
</code></pre></div></li> <li><p>path.win32 属性提供对特定于 Windows 的 path 方法的实现的访问</p></li> <li><p>path.posix 属性提供对 path 方法的 POSIX 特定实现的访问。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>作者为windows 系统<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>sep<span class="token punctuation">,</span> delimiter<span class="token punctuation">,</span> win32<span class="token punctuation">,</span> posix<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sep:'</span><span class="token punctuation">,</span> sep<span class="token punctuation">)</span>
<span class="token comment">// sep: \</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'delimiter:'</span><span class="token punctuation">,</span> delimiter<span class="token punctuation">)</span>
<span class="token comment">// delimiter: ;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'posix sep:'</span><span class="token punctuation">,</span> posix<span class="token punctuation">.</span>sep<span class="token punctuation">)</span>
<span class="token comment">// posix sep: /</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'posix delimiter:'</span><span class="token punctuation">,</span> posix<span class="token punctuation">.</span>delimiter<span class="token punctuation">)</span>
<span class="token comment">// posix delimiter: :</span>
</code></pre></div></li></ul></li></ul> <h4 id="特殊注意"><a href="#特殊注意" class="header-anchor">#</a> 特殊注意</h4> <ul><li>关于path: _dirname _filename 总是返回文件的绝对路径</li> <li>关于path: process.cwd() 总是返回node命令执行的路径（调用node的路径)</li> <li>require 方法的路径总是相对于当前文件</li></ul> <h3 id="nodeapi-之-buffer"><a href="#nodeapi-之-buffer" class="header-anchor">#</a> nodeAPI 之 Buffer</h3> <h4 id="缓冲器-buffer"><a href="#缓冲器-buffer" class="header-anchor">#</a> 缓冲器 Buffer</h4> <ul><li><code>Buffer</code> 类是作为 Node.js API 的一部分引入的，用于在 TCP 流、文件系统操作、以及其他上下文中与八位字节流进行交互</li> <li><code>Buffer</code> 是用来处理二进制数据流的</li> <li><code>Buffer</code> 实例类似于整数数组，但是其长度大小固定(创建后不可修改)</li> <li><code>Buffer</code> c++ 在V8堆外分配的物理内存</li> <li><code>Buffer</code> 是一个全局变量，直接挂载在global下</li></ul> <h4 id="buffer的常用静态属性和方法"><a href="#buffer的常用静态属性和方法" class="header-anchor">#</a> Buffer的常用静态属性和方法:</h4> <ul><li><p>Buffer.alloc()</p> <ul><li><code>Buffer.alloc(10)</code> 第一个参数为长度，不填内容（第二个参数），即用 0 填充</li> <li><code>Buffer.alloc(10, 1)</code> 第二参数为填充内容</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个长度为10的buffer</span>
<span class="token comment">// 输出结果： &lt;Buffer 00 00 00 00 00 00 00 00 00 00&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 创建一个长度为10的buffer 并且使用1作为默认位的填充</span>
<span class="token comment">// 输出结果： &lt;Buffer 01 01 01 01 01 01 01 01 01 01&gt;</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>Buffer.allocUnsafe()
</code></pre></div><ul><li>创建一个长度为 10、且未初始化的 <code>Buffer</code>。</li> <li>这个方法比调用 <code>Buffer</code>.alloc() 更快，</li> <li>但返回的 <code>Buffer</code> 实例可能包含旧数据，</li> <li>因此需要使用 fill() 或 write() 重写。</li> <li>不常用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//  &lt;Buffer 98 fe a5 8d fa 01 00 00 58 ff&gt; 未经初始化的混乱Buffer</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>Buffer.from()
</code></pre></div><ul><li><code>Buffer.from([1,2,3])</code> 创建一个包含 [0x1, 0x2, 0x3] 的 Buffer。</li> <li><code>Buffer.from('test', 'latin1')</code>  创建一个包含 Latin-1 字节 [0x74, 0xe9, 0x73, 0x74] 的 Buffer</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &lt;Buffer 01 02 03&gt;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'latin1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// &lt;Buffer 74 65 73 74&gt;</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>Buffer.byteLength()
</code></pre></div><ul><li>返回字符串的实际字节长度。 与 String.prototype.length 不同，后者返回字符串的字符数</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span> <span class="token comment">// 4 英文字母占位一个字节</span>
Buffer<span class="token punctuation">.</span><span class="token function">byteLength</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span> <span class="token comment">// 6 中文占位三个字节</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>Buffer.isBuffer(obj)
</code></pre></div><ul><li>obj 是一个 Buffer，则返回 true，否则返回 false。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token boolean">false</span>
Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token boolean">true</span>
</code></pre></div></li> <li><p>Buffer.concat()</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 用含有三个 `Buffer` 实例的数组创建一个单一的 `Buffer`。</span>

    <span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> buf3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> totalLength <span class="token operator">=</span> buf1<span class="token punctuation">.</span>length <span class="token operator">+</span> buf2<span class="token punctuation">.</span>length <span class="token operator">+</span> buf3<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>totalLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印: 42</span>
    <span class="token comment">// 如果已知长度，则明确提供长度会更快</span>
    <span class="token keyword">const</span> bufA <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>buf1<span class="token punctuation">,</span> buf2<span class="token punctuation">,</span> buf3<span class="token punctuation">]</span><span class="token punctuation">,</span> totalLength<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bufA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印: &lt;Buffer 00 00 00 00 ...&gt;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bufA<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印: 42</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.length
</code></pre></div><ul><li>返回内存中分配给 buf 的字节数。 不一定反映 buf 中可用数据的字节量。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'1212！'</span><span class="token punctuation">)</span>
buf<span class="token punctuation">.</span>length
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.toString([encoding[, start[, end]]])
</code></pre></div><ul><li>encoding  使用的字符编码。默认值: 'utf8'。</li> <li>start  开始解码的字节偏移量。默认值: 0。</li> <li>end  结束解码的字节偏移量（不包含）。默认值: buf.length。</li> <li>返回:</li> <li>根据 encoding 指定的字符编码将 buf 解码成字符串。 传入 start 和 end 可以只解码 buf 的子集。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.fill()
</code></pre></div><ul><li>修改buf值</li> <li>buf.fill(value[, offset[, end]][, encoding])</li> <li>value  |  |  |  用来填充 buf 的值。</li> <li>offset  开始填充 buf 的偏移量。默认值: 0。</li> <li>end  结束填充 buf 的偏移量（不包含）。默认值: buf.length。</li> <li>encoding  如果 value 是字符串，则指定 value 的字符编码。默认值: 'utf8'。</li> <li>返回:  buf 的引用。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&lt;Buffer 00 00 65 65 65 00 00 00 00 00&gt;</span>
</code></pre></div></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.equals(otherBuffer)
</code></pre></div><ul><li><p>对比两个buf的值是否相同</p></li> <li><p>otherBuffer  要与 bur 对比的 Buffer 或 Uint8Array。</p></li> <li><p>返回:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ABC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'414243'</span><span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> buf3 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ABCD'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>buf2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印: true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>buf3<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 打印: false</span>
</code></pre></div></li></ul></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.indexOf()
</code></pre></div><p>类似于数组的 Array.indexOf()</p> <ul><li>汉字占三个字符， ==&gt; 解决可能出现的中文乱码问题</li></ul></li> <li><div class="language- extra-class"><pre class="language-text"><code>buf.copy(target[, targetStart[, sourceStart[, sourceEnd]]])
</code></pre></div><ul><li><p>target  |  要拷贝进的 Buffer 或 Uint8Array。</p></li> <li><p>targetStart  target 中开始写入之前要跳过的字节数。默认值: 0。</p></li> <li><p>sourceStart  buf 中开始拷贝的偏移量。默认值: 0。</p></li> <li><p>sourceEnd  buf 中结束拷贝的偏移量（不包含）。默认值: buf.length。</p></li> <li><p>返回:  拷贝的字节数。</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 创建两个 `Buffer` 实例。</span>
    <span class="token keyword">const</span> buf1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> buf2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">26</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 97 是 'a' 的十进制 ASCII 值。</span>
    buf1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 拷贝 `buf1` 中第 16 至 19 字节偏移量的数据到 `buf2` 第 8 字节偏移量开始。</span>
    buf1<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>buf2<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印: !!!!!!!!qrst!!!!!!!!!!!!!</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// 创建一个 `Buffer`，并拷贝同一 `Buffer` 中一个区域的数据到另一个重叠的区域。</span>

    <span class="token keyword">const</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">allocUnsafe</span><span class="token punctuation">(</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">26</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 97 是 'a' 的十进制 ASCII 值。</span>
    buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    buf<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 打印: efghijghijklmnopqrstuvwxyz</span>
</code></pre></div></li></ul></li> <li><div class="language- extra-class"><pre class="language-text"><code>string_decoder
</code></pre></div><ul><li><p>string_decoder 模块提供了一个 API，用于以保留编码的多字节 UTF-8 和 UTF-16 字符的方式将 Buffer 对象解码为字符串</p> <div class="language- extra-class"><pre class="language-text"><code>    // 如何去除buffer中文乱码
    const buf = Buffer.from('中文乱码在此！')
    // string_decoder 是buffer的内置模块
    // 将 Buffer 实例写入 StringDecoder 实例时，将使用内部缓冲区来确保已解码的字符串不包含任何不完整的多字节字符。
    // 它们保存在缓冲区中，直到下一次调用 stringDecoder.write() 或调用 stringDecoder.end() 为止
    // 简单说就是会自动识别多字节字符，代码操作出现不完整的情况下不做输出，
    //而是存储在内存中，在下一次操作中拼接在起始位置
    const { StringDecoder } = require('string_decoder')
    const decoder = new StringDecoder('utf8')
    for(let  i = 0; i&lt; buf.length; i+=5) {
        // 生成未初始化的Buffer
        const b = Buffer.allocUnsafe(5)
        // 拷贝
        buf.copy(b, 0, i)
        console.log(b.toString())
        // 结果
        // 中�
        // �乱�
        // ��在
        // 此�
        // ��4�║
    }
    for(let  i = 0; i&lt; buf.length; i+=5) {
        // 生成未初始化的Buffer
        const b = Buffer.allocUnsafe(5)
        // 拷贝
        buf.copy(b, 0, i)
        console.log(decoder.write(b))
    }
</code></pre></div></li></ul></li></ul> <h3 id="node内置模块-之-events"><a href="#node内置模块-之-events" class="header-anchor">#</a> node内置模块 之 events</h3> <h4 id="events-事件触发器"><a href="#events-事件触发器" class="header-anchor">#</a> events 事件触发器</h4> <ul><li><p>events 属于内置模块</p></li> <li><p>所有能触发事件的对象都是 EventEmitter 类的实例。</p></li> <li><p>事件的命名通常是驼峰式的字符串，但也可以使用任何有效的 JavaScript 属性键。</p></li> <li><p>EventEmitter 对象触发一个事件时，所有绑定在该事件上的函数都会被同步地调用。 被调用的监听器返回的任何值都将会被忽略并丢弃。</p></li> <li><p>简单使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  eventEmitter.on() 用于注册监听器， eventEmitter.emit() 用于触发事件</span>
<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token comment">// EventEmitter继承 类 events</span>
<span class="token keyword">class</span> <span class="token class-name">myEvent</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 实例化 myEvent</span>
<span class="token keyword">const</span> myEventClick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 监听myClick</span>
myEventClick<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'myClick'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Click'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 触发myClick</span>
    myEventClick<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'myClick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
    打印 
    myClick
    myClick
    myClick
    <span class="token operator">...</span>
<span class="token operator">--</span><span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>传递参数 <code>params</code></p> <ul><li>需要注意emit首参为触发的函数名称，后续参数均为自定义参数</li> <li>另外需注意传参顺序，实参与形参不再敖述</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 引入内置模块 events</span>
<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token comment">// EventEmitter 继承 events</span>
<span class="token keyword">class</span> <span class="token class-name">myEvent</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 实例化 myEvent</span>
<span class="token keyword">const</span> ce <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 监听错误 传入参数</span>
ce<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> time</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 触发错误</span>
ce<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'error111'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// emit首参为触发的函数名称，后续参数均为自定义参数，</span>
<span class="token comment">/**
 * Error: error111
    at Object.&lt;anonymous&gt; (E:\***\***\?$\api\04_events_param.js:15:18)
    ...
    at bootstrapNodeJSCore (internal/bootstrap/node.js:739:3)
    1574242863420
 * 
 */</span>
</code></pre></div></li> <li><p>只触发一次 <code>once</code> 平时实际项目中会遇到事件只触发一次的情况，使用once 即可做到。可类比与vue以及jq的once,概念大同小异</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span>

<span class="token comment">// 继承EventEmitter 类</span>
<span class="token keyword">class</span> <span class="token class-name">myEvent</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> myEventClick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 监听myClick</span>
myEventClick<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'myClick'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Click'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 触发myClick</span>
    myEventClick<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'myClick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>
只打印一次
myClick
<span class="token operator">--</span><span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>移除事件监听函数 <code>removeListener</code> <code>removeAllListeners</code></p> <ul><li><code>removeListener</code> 移除特定函数 需要传递监听事件以及对应的函数</li> <li><code>removeAllListeners</code> 移除所有函数 只需要传入对应的监听事件即可</li></ul> <div class="language- extra-class"><pre class="language-text"><code>const EventEmitter = require('events')
class myEvent extends EventEmitter{}
const ce = new myEvent()

// 事件1
function fn1() {
    console.log('fn1')
}
// 事件2
function fn2() {
    console.log('fn2')
}
// 需注意监听同一个事件，可同时触发多个函数
ce.on('click', fn1)
ce.on('click', fn2)

setInterval(() =&gt; {
    // 触发myClick
    ce.emit('click')
}, 500)

setInterval(() =&gt; {
    // 触发myClick
    ce.removeListener('click', fn2)
    // 全部移除 只需要传入监听的事件名
// ce.removeAllListeners('click')
}, 1500)
// 打印 可以再一定时段后不再打印fn2，说明已经被移除监听
/**
 * fn1
 * fn2
 * fn1
 * fn2
 * fn1
 * fn1
 * fn1
 * fn1
 */
</code></pre></div></li></ul> <h3 id="fs-文件系统"><a href="#fs-文件系统" class="header-anchor">#</a> fs 文件系统</h3> <h4 id="简单介绍"><a href="#简单介绍" class="header-anchor">#</a> 简单介绍</h4> <blockquote><p>fs模块是node.js的内置模块</p> <blockquote><p>fs 模块提供了一个 API，用于以模仿标准 POSIX 函数的方式与文件系统进行交互</p> <blockquote><p>需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</p></blockquote></blockquote></blockquote> <h4 id="读文件"><a href="#读文件" class="header-anchor">#</a> 读文件</h4> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./06_fs.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//  如果出现错误 通过throw输出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 打印 二进制 一个buf</span>
<span class="token comment">/**
 * PS E:\xxx\ccc\aaa\api&gt; node 06_fs.js
    &lt;Buffer 2f 2f 20 e6 89 80 e6 9c 89 e6 96 87
    e4 bb b6 e7 b3 bb e7 bb 9f e6 93 8d e4 bd 9c
    e9 83 bd e5 85 b7 e6 9c 89 e5 90 8c e6 ad a5
    e5 92 8c e5 bc 82 e6 ad ... &gt;
 */</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>
#### 写文件

```js

//  写一个文件

const fs = require('fs')

fs.writeFile('./test.js', 'test test', {
    encoding: 'utf8'
}, (err) =&gt; {
    if (err) throw err
    console.log('done!')
})

//  打印 
// 在本文件价下增加一个test.js文件 内容为 test test
// done! 
</code></pre></div><h4 id="输出为特定格式-例如字符串"><a href="#输出为特定格式-例如字符串" class="header-anchor">#</a> 输出为特定格式 例如字符串</h4> <ul><li><p>toString()</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./07_fs_throw_string.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//  如果出现错误 通过throw输出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 输出字符串</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>打印 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token comment">/**
 *  PS E:\xxx\xxx\xxx\api&gt; node 07_fs_throw_string.js
    &lt;Buffer 2f 2f 20 20 e8 be 93 e5 87 ba 20 e5 
    ad 97 e7 ac a6 e4 b8 b2 0d 0a 63 6f 6e 73 74 
    20 66 73 20 3d 20 72 65 71 75 69 72 65 28 27
    66 73 27 29 0d 0a 2f 2f ... &gt;
    //  输出 字符串
    const fs = require('fs')
    // 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。
    fs.readFile('./07_fs_throw_string.js', (err, data) =&gt; {
        //  如果出现错误 通过throw输出
        if (err) throw err
        console.log(data)
        // 输出字符串
        console.log(data.toString())
    })
 */</span>
</code></pre></div></li> <li><p>传入参数~</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./08_fs_throw_string.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//  如果出现错误 通过throw输出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 输出</span>
<span class="token comment">// const fs = require('fs')</span>
<span class="token comment">// // 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</span>
<span class="token comment">// fs.readFile('./08_fs_throw_string.js', 'utf8', (err, data) =&gt; {</span>
<span class="token comment">//     //  如果出现错误 通过throw输出</span>
<span class="token comment">//     if (err) throw err</span>
<span class="token comment">//     console.log(data)</span>
<span class="token comment">// })</span>
</code></pre></div></li></ul> <h4 id="异步同步"><a href="#异步同步" class="header-anchor">#</a> 异步同步</h4> <blockquote><p>两者都需要读取完文件（或者部分读取）才能返回文件，都是需要等待的，那么两者的区别什么呢 ？</p></blockquote> <ul><li><p>对于单独用户使用服务器来说是没有区别的，或者说区别不明显。</p></li> <li><p>但是web实际场景中是大量的用户在使用，同步会导致前面的用户处理阻挡后面的用户处理。</p></li> <li><p>异步则会直接在让其单独等待，继续处理其他，实现了高并发。</p></li> <li><p>另外所有的api 都有同步的版本，详见node</p></li> <li><p>举个例子</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 异步</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./08_fs_throw_string.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//  如果出现错误 通过throw输出</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111111111</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//  同步</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./09_fs_sync.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token comment">// 打印</span>
<span class="token comment">/**
 * // 异步
    const fs = require('fs')
    // 需要注意一点 如果操作成功完成，则第一个参数将为 null 或 undefined。
    fs.readFile('./08_fs_throw_string.js', 'utf8', (err, data) =&gt; {
        //  如果出现错误 通过throw输出
        if (err) throw err
        console.log(111111111)
    })

    //  同步
    const data = fs.readFileSync('./09_fs_sync.js', 'utf8')

    console.log(data)
    111111111
 * 
 */</span>
</code></pre></div></li></ul> <blockquote><p><strong>可以看到同步的方法即使写在后面也会先执行，因为异步的方法是交给i/o去执行的</strong></p></blockquote> <h3 id="fs-stat"><a href="#fs-stat" class="header-anchor">#</a> fs.Stat</h3> <ul><li><p>对象提供了关于文件的信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'./11_fs_stat.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 是否为文件 true</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 是否为文件夹 false</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span> <span class="token comment">// 所有信息 ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <blockquote><p>特殊技巧</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token comment">// stats对象的使用技巧 判断一个文件是不是存在</span>
    fs<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">'./11111_fs_stat.js'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 只要报错，那么就说明文件不存在</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件不存在，以及其他业务逻辑'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-rename"><a href="#fs-rename" class="header-anchor">#</a> fs.rename</h3> <ul><li>修改文件名</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">'./test.js'</span><span class="token punctuation">,</span> <span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-unlink"><a href="#fs-unlink" class="header-anchor">#</a> fs.unlink</h3> <ul><li>删除文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'./test.txt'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-readdir"><a href="#fs-readdir" class="header-anchor">#</a> fs.readdir</h3> <ul><li>读取文件夹</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    <span class="token comment">// 注意是将所有的下属文件名，置于一个array</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-mkdir"><a href="#fs-mkdir" class="header-anchor">#</a> fs.mkdir</h3> <ul><li>创建一个文件夹</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-rmdir"><a href="#fs-rmdir" class="header-anchor">#</a> fs.rmdir</h3> <ul><li>删除文件夹</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 不写回调函数</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'./test'</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 报错
 * fs.js:137
    throw new ERR_INVALID_CALLBACK();
    ^

    TypeError [ERR_INVALID_CALLBACK]: Callback must be a function
 */</span>
<span class="token comment">// 一部不写回调函数会报一个警告，但是在后续的版本中会报错，异步均需要编写回调函数</span>
复制代码
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span><span class="token function">rmdir</span><span class="token punctuation">(</span><span class="token string">'./test'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 推荐
</code></pre></div><h3 id="fs-watch-还有一个类似fs-watchfile"><a href="#fs-watch-还有一个类似fs-watchfile" class="header-anchor">#</a> fs.watch (还有一个类似fs.watchFile)</h3> <ul><li>监视文件变化</li> <li>fs.watch 的 API 在各个平台上并非 100％ 一致，在某些情况下不可用。仅在 macOS 和 Windows 上支持 recursive 选项</li> <li>处理文件中非常有用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token comment">// 回调函数一参数为改变的类型，二参数为改变的文件</span>
<span class="token comment">// recursive 回调监听子文件夹；</span>
fs<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>recursive<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">eventType<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>至此常用的<code>api</code>以及<code>内置模块</code>介绍完毕，下面将会介绍静态服务器。</p></blockquote></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/SuYxh/ironBlog/edit/master/docs/views/other/node/module (模块) 常用以及注意事项.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2020-8-24 9:37:00</span></div></footer> <!----></main> <!----></Common><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/assets/js/app.83e161de.js" defer></script><script src="/assets/js/5.0d63161d.js" defer></script><script src="/assets/js/1.c082d7cd.js" defer></script><script src="/assets/js/75.04bedc64.js" defer></script>
  </body>
</html>
